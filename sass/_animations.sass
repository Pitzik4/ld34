// Why's WebKit gotta be so weird?
=css-keyframes($name)
  @keyframes #{$name}
    @content
  @-webkit-keyframes #{$name}
    @content
=css-animation($args...)
  animation: $args
  -webkit-animation: $args


=sprite($name, $image, $width, $height)
  .spr-#{$name}
    position: absolute
    width: $width
    height: $height
    overflow: hidden
    
    &::before
      content: url('img/#{$image}')
      height: 100%
      position: absolute
      top: 0
    
    @content

=sheet-animation($name, $fps, $iterations, $frames...)
  $anim-name: an#{random(10000)}
  
  +css-keyframes($anim-name)
    @for $i from 1 through length($frames)
      #{100% * ($i - 1) / length($frames)}
        left: nth($frames, $i) * -100%
    to
      left: nth($frames, length($frames)) * -100%
  
  &.anim-#{$name}::before
    +css-animation(#{length($frames) / $fps}s step-end 0s $iterations normal both running $anim-name)

=shake-animation($name, $fps, $iterations, $pos, $frames...)
  $anim-name: an#{random(10000)}
  
  +css-keyframes($anim-name)
    $spacing: 100% / length($frames)
    @for $i from 1 through length($frames)
      $timing: ($i - 1) * $spacing
      $current: nth($frames, $i)
      @if $current == 0
        @if $i == 1 or nth($frames, $i - 1) != 0
          #{$timing}
            #{$pos}: 0
      @else
        $v: nth($current, 1)
        $d: nth($current, 2)
        $q: nth($current, 3)
        $s: $spacing * $d / $q
        @for $j from 0 through $q - 1
          $force: $v * (1 - ($j / $q))
          #{$timing + $s * $j}
            #{$pos}: $force
          #{$timing + $s * ($j + 0.5)}
            #{$pos}: $force * -1
        #{$timing + $spacing * $d}
          #{$pos}: 0
    to
      #{$pos}: 0
  
  &.anim-#{$name}
    +css-animation(#{length($frames) / $fps}s step-end 0s $iterations normal both running $anim-name)
